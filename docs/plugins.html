<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Writing plugins &#8212; MapProxy 1.16.0 Docs</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-sphinx.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MapProxy 2.0" href="mapproxy_2.html" />
    <link rel="prev" title="Development" href="development.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>

  </head><body>

<div id="navbar" class="navbar navbar-default ">
  <div class="container">
    <div class="navbar-header">
      <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="index.html" class="pull-left"><img src="_static/logo.png" height="50">
      </a>
      <a class="navbar-brand" href="index.html">
        <span>
          MapProxy</span>
        <span>1.16.0</span>
      </a>
    </div>
    <div class="collapse navbar-collapse nav-collapse">
      
        
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_windows.html">Installation on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_osgeo4w.html">Installation on OSGeo4W</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_docker.html">Installation via Docker</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources.html">Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="caches.html">Caches</a></li>
<li class="toctree-l1"><a class="reference internal" href="seed.html">Seeding</a></li>
<li class="toctree-l1"><a class="reference internal" href="coverages.html">Coverages</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapproxy_util.html">mapproxy-util</a></li>
<li class="toctree-l1"><a class="reference internal" href="mapproxy_util_autoconfig.html">mapproxy-util autoconfig</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration_examples.html">Configuration examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspire.html">INSPIRE View Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="labeling.html">WMS Labeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="auth.html">Authentication and Authorization</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorate_img.html">Decorate Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Writing plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-add-a-plugin">How to add a plugin ?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-service">Adding a new service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-layer-metadata-in-yaml-configuration-file">Customizing layer metadata in YAML configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-source">Adding a new source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customizing-the-demo-service">Customizing the demo service</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-commands-to-mapproxy-util">Adding new commands to mapproxy-util</a></li>
<li class="toctree-l2"><a class="reference internal" href="#credits">Credits</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mapproxy_2.html">MapProxy 2.0</a></li>
</ul>

        </div>
      </div>
    <div class="col-md-8">
      
  <div class="section" id="writing-plugins">
<h1>Writing plugins<a class="headerlink" href="#writing-plugins" title="Permalink to this heading">¶</a></h1>
<p>Since MapProxy 1.15, it is possible to write plugins for MapProxy that can
add new sources, services or commands. This requires Python &gt;= 3.7</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>The mapproxy_hips plugin at <a class="reference external" href="https://github.com/rouault/mapproxy_hips">https://github.com/rouault/mapproxy_hips</a> is an
example of a plugin, which adds a new source, service and customizes the demo
service, demonstrating all the below points.</p>
</div>
<div class="section" id="how-to-add-a-plugin">
<h2>How to add a plugin ?<a class="headerlink" href="#how-to-add-a-plugin" title="Permalink to this heading">¶</a></h2>
<p>A plugin should be written as a Python package whose setuptools <code class="docutils literal notranslate"><span class="pre">setup()</span></code>
method has a <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> keyword with a group <code class="docutils literal notranslate"><span class="pre">mapproxy</span></code> pointing to
a module with a <code class="docutils literal notranslate"><span class="pre">plugin_entrypoint</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">entry_points</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;mapproxy&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;hips = mapproxy_hips.pluginmodule&quot;</span><span class="p">]},</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">mapproxy_hips/pluginmodule.py</span></code> file should have
a <code class="docutils literal notranslate"><span class="pre">plugin_entrypoint</span></code> method taking no argument and returning nothing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plugin_entrypoint</span><span class="p">():</span>
    <span class="c1"># call different registration methods, like register_service_configuration(),</span>
    <span class="c1"># register_source_configuration()</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>That method is in charge of registering the various registration methods
detailed hereafter.</p>
<p>Plugins will often by dependent on MapProxy internal classes. It is their
responsibility to check the MapProxy version, in case the MapProxy internal
API or behavior would change and make them incompatible.</p>
</div>
<div class="section" id="adding-a-new-service">
<h2>Adding a new service<a class="headerlink" href="#adding-a-new-service" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">mapproxy.config.loader</span></code> module has a <code class="docutils literal notranslate"><span class="pre">register_service_configuration()</span></code>
method to register a new service and specify the allowed keywords for it in
the YAML configuration file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_service_configuration</span><span class="p">(</span><span class="n">service_name</span><span class="p">,</span> <span class="n">service_creator</span><span class="p">,</span>
                                   <span class="n">yaml_spec_service_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yaml_spec_service_def</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Method used by plugins to register a new service.</span>

<span class="sd">        :param config_name: Name of the service</span>
<span class="sd">        :type config_name: str</span>
<span class="sd">        :param service_creator: Creator method of the service</span>
<span class="sd">        :type service_creator: method of type (serviceConfiguration: ServiceConfiguration, conf: dict) -&gt; Server</span>
<span class="sd">        :param yaml_spec_service_name: Name of the service in the YAML configuration file</span>
<span class="sd">        :type yaml_spec_service_name: str</span>
<span class="sd">        :param yaml_spec_service_def: Definition of the service in the YAML configuration file</span>
<span class="sd">        :type yaml_spec_service_def: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This can for example by used like the following snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapproxy.config.loader</span> <span class="kn">import</span> <span class="n">register_service_configuration</span>
<span class="kn">from</span> <span class="nn">mapproxy.service.base</span> <span class="kn">import</span> <span class="n">Server</span>

<span class="k">class</span> <span class="nc">MyExtraServiceServer</span><span class="p">(</span><span class="n">Server</span><span class="p">):</span>
    <span class="c1"># Look at classes at https://github.com/mapproxy/mapproxy/tree/master/mapproxy/service</span>
    <span class="c1"># for a real implementation</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;my_extra_service&#39;</span><span class="p">,)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">my_extra_service_method</span><span class="p">(</span><span class="n">serviceConfiguration</span><span class="p">,</span> <span class="n">conf</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">MyExtraServiceServer</span><span class="p">()</span>

<span class="n">register_service_configuration</span><span class="p">(</span><span class="s1">&#39;my_extra_service&#39;</span><span class="p">,</span> <span class="n">my_extra_service_method</span><span class="p">,</span>
                               <span class="s1">&#39;my_extra_service&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">()})</span>
</pre></div>
</div>
<p>This allows the following declaration in the YAML mapproxy configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="nt">my_extra_service</span><span class="p">:</span>
<span class="w">        </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
</pre></div>
</div>
<p>A real-world implementation can be found at <a class="reference external" href="https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/service/hips.py">https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/service/hips.py</a></p>
</div>
<div class="section" id="customizing-layer-metadata-in-yaml-configuration-file">
<h2>Customizing layer metadata in YAML configuration file<a class="headerlink" href="#customizing-layer-metadata-in-yaml-configuration-file" title="Permalink to this heading">¶</a></h2>
<p>When implementing a new service, it might be useful to add per-layer metadata
for it. The YAML validator needs to be updated to recognize the new keywords.
The <code class="docutils literal notranslate"><span class="pre">add_subcategory_to_layer_md()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">mapproxy.config.spec</span></code> module
can be used to do that.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_subcategory_to_layer_md</span><span class="p">(</span><span class="n">category_name</span><span class="p">,</span> <span class="n">category_def</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add a new category to wms_130_layer_md.</span>
<span class="sd">        Used by plugins</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This can for example be used like in the following snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapproxy.config.spec</span> <span class="kn">import</span> <span class="n">add_subcategory_to_layer_md</span>

<span class="c1"># Add a &#39;hips&#39; subcategory to layer spec to be able to define hips service</span>
<span class="c1"># specific layer metadata</span>
<span class="n">add_subcategory_to_layer_md</span><span class="p">(</span><span class="s1">&#39;hips&#39;</span><span class="p">,</span> <span class="n">anything</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-a-new-source">
<h2>Adding a new source<a class="headerlink" href="#adding-a-new-source" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">mapproxy.config.loader</span></code> module has a <code class="docutils literal notranslate"><span class="pre">register_source_configuration()</span></code>
method to register a new source and specify the allowed keywords for it in
the YAML configuration file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_source_configuration</span><span class="p">(</span><span class="n">config_name</span><span class="p">,</span> <span class="n">config_class</span><span class="p">,</span>
                                  <span class="n">yaml_spec_source_name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">yaml_spec_source_def</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Method used by plugins to register a new source configuration.</span>

<span class="sd">        :param config_name: Name of the source configuration</span>
<span class="sd">        :type config_name: str</span>
<span class="sd">        :param config_class: Class of the source configuration</span>
<span class="sd">        :type config_name: SourceConfiguration</span>
<span class="sd">        :param yaml_spec_source_name: Name of the source in the YAML configuration file</span>
<span class="sd">        :type yaml_spec_source_name: str</span>
<span class="sd">        :param yaml_spec_source_def: Definition of the source in the YAML configuration file</span>
<span class="sd">        :type yaml_spec_source_def: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This can for example by used like the following snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapproxy.config.loader</span> <span class="kn">import</span> <span class="n">register_source_configuration</span>
<span class="kn">from</span> <span class="nn">mapproxy.config.loader</span> <span class="kn">import</span> <span class="n">SourceConfiguration</span>

<span class="k">class</span> <span class="nc">my_source_configuration</span><span class="p">(</span><span class="n">SourceConfiguration</span><span class="p">):</span>
    <span class="n">source_type</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;my_extra_source&#39;</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Look at classes at https://github.com/mapproxy/mapproxy/tree/master/mapproxy/source</span>
        <span class="c1"># for a real implementation</span>
        <span class="k">class</span> <span class="nc">MySource</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
            <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">MySource</span><span class="p">()</span>

<span class="n">register_source_configuration</span><span class="p">(</span><span class="s1">&#39;my_extra_source&#39;</span><span class="p">,</span> <span class="n">my_source_configuration</span><span class="p">,</span>
                              <span class="s1">&#39;my_extra_source&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">()})</span>
</pre></div>
</div>
<p>This allows the following declaration in the YAML mapproxy configuration file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">sources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">some_source_name</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my_extra_source</span>
<span class="w">        </span><span class="nt">foo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar</span>
</pre></div>
</div>
<p>A real-world implementation can be found at <a class="reference external" href="https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/source/hips.py">https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/source/hips.py</a></p>
</div>
<div class="section" id="customizing-the-demo-service">
<h2>Customizing the demo service<a class="headerlink" href="#customizing-the-demo-service" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="services.html#demo-service-label"><span class="std std-ref">MapProxy Demo Service</span></a> can be customized in two ways:</p>
<ul>
<li><p>Customizing the output of the <code class="docutils literal notranslate"><span class="pre">/demo</span></code> HTML output, typically by adding entries
for new services. This is done with the <code class="docutils literal notranslate"><span class="pre">register_extra_demo_substitution_handler()</span></code>
method of the <code class="docutils literal notranslate"><span class="pre">mapproxy.service.demo</span></code> module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_extra_demo_substitution_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Method used by plugins to register a new handler for doing substitutions</span>
<span class="sd">        to the HTML template used by the demo service.</span>
<span class="sd">        The handler passed to this method is invoked by the DemoServer._render_template()</span>
<span class="sd">        method. The handler may modify the passed substitutions dictionary</span>
<span class="sd">        argument. Keys of particular interest are &#39;extra_services_html_beginning&#39;</span>
<span class="sd">        and &#39;extra_services_html_end&#39; to add HTML content before/after built-in</span>
<span class="sd">        services.</span>

<span class="sd">        :param handler: New handler for incoming requests</span>
<span class="sd">        :type handler: function that takes 3 arguments(DemoServer instance, req and a substitutions dictionary argument).</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
<li><p>Handling new request paths under the <code class="docutils literal notranslate"><span class="pre">/demo/</span></code> hierarchy, typically to implement a new
service. This is done with the <code class="docutils literal notranslate"><span class="pre">register_extra_demo_server_handler()</span></code>
method of the <code class="docutils literal notranslate"><span class="pre">mapproxy.service.demo</span></code> module.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_extra_demo_server_handler</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Method used by plugins to register a new handler for the demo service.</span>
<span class="sd">        The handler passed to this method is invoked by the DemoServer.handle()</span>
<span class="sd">        method when receiving an incoming request. This enables handlers to</span>
<span class="sd">        process it, in case it is relevant to it.</span>

<span class="sd">        :param handler: New handler for incoming requests</span>
<span class="sd">        :type handler: function that takes 2 arguments (DemoServer instance and req) and</span>
<span class="sd">                       returns a string with HTML content or None</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>This can for example be used like in the following snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapproxy.service.demo</span> <span class="kn">import</span> <span class="n">register_extra_demo_server_handler</span><span class="p">,</span> <span class="n">register_extra_demo_substitution_handler</span>

<span class="k">def</span> <span class="nf">demo_server_handler</span><span class="p">(</span><span class="n">demo_server</span><span class="p">,</span> <span class="n">req</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;my_service&#39;</span> <span class="ow">in</span> <span class="n">req</span><span class="o">.</span><span class="n">args</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;my_return&#39;</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">demo_substitution_handler</span><span class="p">(</span><span class="n">demo_server</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">substitutions</span><span class="p">):</span>
    <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;h2&gt;My extra service&lt;/h2&gt;&#39;</span>
    <span class="n">html</span> <span class="o">+=</span> <span class="s1">&#39;&lt;a href=&quot;/demo?my_service&quot;&gt;My service&lt;/a&gt;&#39;</span>
    <span class="n">substitutions</span><span class="p">[</span><span class="s1">&#39;extra_services_html_beginning&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">html</span>

<span class="n">register_extra_demo_server_handler</span><span class="p">(</span><span class="n">demo_server_handler</span><span class="p">)</span>
<span class="n">register_extra_demo_substitution_handler</span><span class="p">(</span><span class="n">demo_substitution_handler</span><span class="p">)</span>
</pre></div>
</div>
<p>A real-world example can be found at <a class="reference external" href="https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/service/demo_extra.py">https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/service/demo_extra.py</a></p>
</div>
<div class="section" id="adding-new-commands-to-mapproxy-util">
<h2>Adding new commands to mapproxy-util<a class="headerlink" href="#adding-new-commands-to-mapproxy-util" title="Permalink to this heading">¶</a></h2>
<p>New commands can be added to <a class="reference internal" href="mapproxy_util.html#mapproxy-util"><span class="std std-ref">mapproxy-util</span></a> by using the
<code class="docutils literal notranslate"><span class="pre">register_command()</span></code> method of the <code class="docutils literal notranslate"><span class="pre">mapproxy.script.util</span></code> module</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">register_command</span><span class="p">(</span><span class="n">command_name</span><span class="p">,</span> <span class="n">command_spec</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Method used by plugins to register a command.</span>

<span class="sd">        :param command_name: Name of the command</span>
<span class="sd">        :type command_name: str</span>
<span class="sd">        :param command_spec: Definition of the command. Dictionary with a &#39;func&#39; and &#39;help&#39; member</span>
<span class="sd">        :type command_spec: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>This can for example be used like in the following snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">from</span> <span class="nn">mapproxy.script.util</span> <span class="kn">import</span> <span class="n">register_command</span>

<span class="k">def</span> <span class="nf">my_command</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="s2">&quot;%prog my_command [options] -f mapproxy_conf -l layer&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--mapproxy-conf&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;mapproxy_conf&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;MapProxy configuration.&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-l&quot;</span><span class="p">,</span> <span class="s2">&quot;--layer&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Layer&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># remove script name</span>

    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">mapproxy_conf</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">options</span><span class="o">.</span><span class="n">layer</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Do something</span>


<span class="n">register_command</span><span class="p">(</span><span class="s1">&#39;my_command&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="n">my_command</span><span class="p">,</span>
    <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Do something.&#39;</span>
<span class="p">})</span>
</pre></div>
</div>
<p>A real-world example can be found at
<a class="reference external" href="https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/script/hipsallsky.py">https://github.com/rouault/mapproxy_hips/blob/master/mapproxy_hips/script/hipsallsky.py</a>
`</p>
</div>
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this heading">¶</a></h2>
<p>The development of the plugin mechanism has been funded by
Centre National d’Etudes Spatiales (CNES): <a class="reference external" href="https://cnes.fr">https://cnes.fr</a></p>
</div>
</div>


    </div>
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
    </p>
    <p>
     
       &copy; Copyright Oliver Tonnhofer, Omniscale, <a href="http://mapproxy.org/about">Legal</a>
     
     <br/>
     
       Last updated on 2023-04-13
     <br/>

     
       Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.0.1.
     
   </p>
 </div>
</footer>
  </body>
</html>